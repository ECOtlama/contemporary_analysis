
# Creating intergenic bam files

```{bash}

mkdir /home/mlucena/grupolince/lynx_genomes_5x/BAM_files_final/BAM_intergenic
cd /home/mlucena/grupolince/lynx_genomes_5x/BAM_files_final/BAM_intergenic

screen -S extracting_intergenic_from_bam_files_using_bedtools
script extracting_intergenic_from_bam_files_using_bedtools.log

INPUTFILE_BED="/GRUPOS/grupolince/Lyp_annotation_Apr14_final/LYPA23C.intergenic.PLUS1000.bed"
OUTPUT_DIR="/home/mlucena/grupolince/lynx_genomes_5x/BAM_files_final/BAM_intergenic"

cd /home/mlucena/grupolince/lynx_genomes_5x/BAM_files_final/

POPS=("c_ll_ka" "c_ll_og"  "c_ll_tu")  

task(){
   bedtools intersect -a $i -b /GRUPOS/grupolince/Lyp_annotation_Apr14_final/LYPA23C.intergenic.PLUS1000.bed -sorted -g /home/mlucena/grupolince/lynx_genomes_5x/BAM_files_final/BAM_intergenic/lp23.version.sorted.genome > $OUTPUT_DIR/${i/_recal_round-1/_intergenic_bed}; # Si quiero puedo cambiar el nombre a intergenic.bam que es el final. 
   touch $OUTPUT_DIR/${i/_recal_round-1.bam/.finished}
}

for POP in ${POPS[@]}
do
echo $POP
declare -a ARRAY=($(ls "$POP"*.bam)) 
for i in ${ARRAY[@]} 
do
 task "$i" &
done
done


# Para los nuevos remapeados, los muevo a su nombre original:

for sample in $(ls *bed*)
do
echo $sample"--->"${sample/_intergenic_bed.bam/_intergenic.bam} 
mv $sample ${sample/_intergenic_bed.bam/_intergenic.bam}
done
rm *finished

```

Tambien se podría hacer con de la siguiente manera pero es mucho más lento. 

```{bash}

cd /home/mlucena/grupolince/lynx_genomes_5x/BAM_files_final
for i in $( ls c_ll_og*.bam )
do
echo $i
samtools view -bH -@ 40 $i > $OUTPUT_DIR/${i/_recal_round-1/_intergenic}
while read -r -a myArray; do 
samtools view -b -@ 40 $i ${myArray[0]}:${myArray[1]}-${myArray[2]} >> $OUTPUT_DIR/${i/_recal_round-1/_intergenic}
done < $INPUTFILE_BED
done


```


